<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿå“ç‡Ÿé¤ŠæŸ¥è©¢ç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f4f7f9; padding: 10px; margin: 0; }
        .container { max-width: 1000px; margin: 20px auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h1 { color: #1a73e8; text-align: center; font-size: 26px; margin-bottom: 20px; }
        
        /* æœå°‹æ¡†å„ªåŒ–ï¼šç§»é™¤æŒ‰éˆ•ï¼Œæ”¹ç‚ºå…¨å¯¬è‡ªå‹•æœå°‹ */
        .search-box { position: sticky; top: 0; background: white; padding: 10px 0; z-index: 100; }
        input { width: 100%; padding: 15px 20px; border: 2px solid #e0e0e0; border-radius: 30px; font-size: 18px; outline: none; box-sizing: border-box; transition: 0.3s; }
        input:focus { border-color: #1a73e8; box-shadow: 0 0 8px rgba(26,115,232,0.2); }
        
        #status { text-align: center; padding: 10px; color: #777; font-size: 14px; }
        
        /* è¡¨æ ¼æ¨£å¼ï¼šè—åº•ç™½å­—æ¨™é ­ */
        .table-wrapper { overflow-x: auto; margin-top: 15px; border-radius: 8px; border: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; font-size: 15px; min-width: 800px; }
        th { background-color: #1a73e8; color: #ffffff; padding: 14px; position: sticky; top: 0; font-weight: 500; }
        td { padding: 14px; border-bottom: 1px solid #f0f0f0; text-align: center; color: #444; }
        tr:nth-child(even) { background-color: #fafafa; }
        tr:hover { background-color: #f1f7ff; }
        
        .food-name { text-align: left; font-weight: bold; color: #222; position: sticky; left: 0; background: inherit; min-width: 160px; }
        .kcal { color: #d93025; font-weight: bold; }
        .mineral { color: #2e7d32; } 
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ é£Ÿå“ç‡Ÿé¤ŠæŸ¥è©¢ç³»çµ±</h1>
    <div id="status">è³‡æ–™è®€å–ä¸­...</div>
    
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="è¼¸å…¥é£Ÿç‰©åç¨±è‡ªå‹•æœå°‹ (ä¾‹ï¼šå¤§éº¥ã€é›èƒ¸è‚‰)..." disabled>
    </div>

    <div class="table-wrapper">
        <table id="resultTable" style="display:none;">
            <thead>
                <tr>
                    <th style="text-align:left;">æ¨£å“åç¨±</th>
                    <th>ç†±é‡(kcal)</th>
                    <th>è›‹ç™½è³ª(g)</th>
                    <th>è„‚è‚ª(g)</th>
                    <th>ç¢³æ°´(g)</th>
                    <th class="mineral">éˆ‰(mg)</th>
                    <th class="mineral">é‰€(mg)</th>
                    <th class="mineral">ç£·(mg)</th>
                </tr>
            </thead>
            <tbody id="resultBody"></tbody>
        </table>
    </div>
</div>

<script>
    let db = [];
    let cols = { name: 2, kcal: 6, pro: 9, fat: 10, cho: 13, na: 22, k: 23, p: 28 };

    // è¼‰å…¥è³‡æ–™
    Papa.parse("data.csv", {
        download: true,
        header: false,
        skipEmptyLines: true,
        complete: function(results) {
            const rows = results.data;
            let headerIdx = rows.findIndex(r => r.some(cell => cell && cell.includes("æ¨£å“åç¨±")));
            if (headerIdx === -1) headerIdx = 0;

            const headers = rows[headerIdx];
            headers.forEach((h, i) => {
                if(!h) return;
                const txt = h.trim();
                if (txt === "æ¨£å“åç¨±") cols.name = i;
                if (txt.includes("ç†±é‡(kcal)")) cols.kcal = i;
                if (txt.includes("ç²—è›‹ç™½(g)")) cols.pro = i;
                if (txt.includes("ç²—è„‚è‚ª(g)")) cols.fat = i;
                if (txt.includes("ç¸½ç¢³æ°´åŒ–åˆç‰©(g)")) cols.cho = i;
                if (txt.includes("éˆ‰(mg)")) cols.na = i;
                if (txt.includes("é‰€(mg)")) cols.k = i;
                if (txt.includes("ç£·(mg)")) cols.p = i;
            });

            db = rows.slice(headerIdx + 1).map(row => ({
                name: row[cols.name] || "",
                kcal: row[cols.kcal] || "0",
                pro:  row[cols.pro] || "0",
                fat:  row[cols.fat] || "0",
                cho:  row[cols.cho] || "0",
                na:   row[cols.na] || "0",
                k:    row[cols.k] || "0",
                p:    row[cols.p] || "0"
            })).filter(item => item.name !== "");

            document.getElementById('status').innerText = `âœ… æº–å‚™å°±ç·’ï¼å…± ${db.length} ç­†é£Ÿå“è³‡æ–™`;
            document.getElementById('searchInput').disabled = false;
        }
    });

    // å³æ™‚æœå°‹åŠŸèƒ½ (ç›£è½ input äº‹ä»¶)
    document.getElementById('searchInput').addEventListener('input', function(e) {
        const query = e.target.value.trim().toLowerCase();
        const table = document.getElementById('resultTable');
        const body = document.getElementById('resultBody');

        if (!query) {
            table.style.display = 'none';
            return;
        }

        const filtered = db.filter(item => item.name.
