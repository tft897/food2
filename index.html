<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿå“ç‡Ÿé¤Šæˆåˆ†æŸ¥è©¢</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; background-color: #f9f9f9; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; outline: none; }
        input:focus { border-color: #1a73e8; }
        #status { font-size: 14px; margin-bottom: 10px; color: #666; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #1a73e8; color: white; padding: 12px; text-align: left; position: sticky; top: 0; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        tr:hover { background-color: #f1f8f5; }
        .kcal { color: #d93025; font-weight: bold; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ é£Ÿå“ç‡Ÿé¤ŠæŸ¥è©¢ç³»çµ±</h2>
    <div id="status">æ­£åœ¨è¼‰å…¥ data.csv...</div>
    <input type="text" id="searchInput" placeholder="è«‹è¼¸å…¥é£Ÿç‰©åç¨± (å¦‚: é›èƒ¸è‚‰ã€å¤§éº¥)..." disabled>

    <div style="overflow-x: auto;">
        <table id="resultTable" style="display:none;">
            <thead>
                <tr>
                    <th>æ¨£å“åç¨±</th>
                    <th>ç†±é‡(kcal)</th>
                    <th>è›‹ç™½è³ª(g)</th>
                    <th>è„‚è‚ª(g)</th>
                    <th>ç¢³æ°´(g)</th>
                </tr>
            </thead>
            <tbody id="resultBody"></tbody>
        </table>
    </div>
</div>

<script>
    let db = [];

    Papa.parse("data.csv", {
        download: true,
        header: false, // é—œé–‰è‡ªå‹•æ¨™é¡Œï¼Œæ‰‹å‹•è™•ç†
        skipEmptyLines: true,
        complete: function(results) {
            const rows = results.data;
            
            // é£Ÿè—¥ç½²æ ¼å¼å›ºå®šï¼šç¬¬ 0 è¡Œèªªæ˜, ç¬¬ 1 è¡Œæ¨™é¡Œ, ç¬¬ 2 è¡Œèµ·æ˜¯è³‡æ–™
            // æˆ‘å€‘ç›´æ¥å¾ç¬¬ 2 è¡Œé–‹å§‹æŠ“å–ï¼Œä¸¦æŒ‡å®šæ¬„ä½ç´¢å¼•
            if (rows.length > 2) {
                db = rows.slice(2).map(row => {
                    return {
                        name: row[2] ? row[2].trim() : "",    // æ¨£å“åç¨± åœ¨ç¬¬ 3 æ¬„ (index 2)
                        kcal: row[6] || "0",                 // ç†±é‡ åœ¨ç¬¬ 7 æ¬„ (index 6)
                        pro:  row[9] || "0",                 // è›‹ç™½è³ª åœ¨ç¬¬ 10 æ¬„ (index 9)
                        fat:  row[10] || "0",                // è„‚è‚ª åœ¨ç¬¬ 11 æ¬„ (index 10)
                        cho:  row[13] || "0"                 // ç¢³æ°´ åœ¨ç¬¬ 14 æ¬„ (index 13)
                    };
                }).filter(item => item.name !== "");

                document.getElementById('status').innerText = `âœ… è¼‰å…¥æˆåŠŸï¼å…± ${db.length} ç­†é£Ÿå“ã€‚`;
                document.getElementById('status').style.color = "green";
                document.getElementById('searchInput').disabled = false;
            } else {
                document.getElementById('status').innerText = "âŒ æª”æ¡ˆå…§å®¹æ ¼å¼ä¸ç¬¦ (åˆ—æ•¸å¤ªå°‘)ã€‚";
            }
        },
        error: function() {
            document.getElementById('status').innerText = "âŒ æ‰¾ä¸åˆ° data.csvï¼Œè«‹ç¢ºèª GitHub æª”æ¡ˆåç¨±ã€‚";
            document.getElementById('status').style.color = "red";
        }
    });

    document.getElementById('searchInput').addEventListener('input', function(e) {
        const query = e.target.value.trim().toLowerCase();
        const table = document.getElementById('resultTable');
        const body = document.getElementById('resultBody');

        if (!query) {
            table.style.display = 'none';
            return;
        }

        const filtered = db.filter(item => item.name.toLowerCase().includes(query)).slice(0, 50);

        if (filtered.length > 0) {
            table.style.display = 'table';
            body.innerHTML = filtered.map(item => `
                <tr>
                    <td><strong>${item.name}</strong></td>
                    <td class="kcal">${item.kcal}</td>
                    <td>${item.pro}</td>
                    <td>${item.fat}</td>
                    <td>${item.cho}</td>
                </tr>
            `).join('');
        } else {
            table.style.display = 'none';
        }
    });
</script>

</body>
</html>
