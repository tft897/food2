<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é£Ÿå“ç‡Ÿé¤ŠæŸ¥è©¢ç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        /* åŸºç¤è¨­å®šï¼šæ‰‹æ©Ÿç‰ˆå­—é«”å„ªåŒ– */
        body { font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", "Segoe UI", Roboto, sans-serif; background-color: #f0f2f5; padding: 15px; margin: 0; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        h1 { color: #1a73e8; text-align: center; margin: 10px 0 20px 0; font-size: 1.5rem; }
        
        /* --- æœå°‹å€åŸŸå„ªåŒ– --- */
        /* å›ºå®šåœ¨æœ€é ‚éƒ¨ï¼Œå±¤ç´šæœ€é«˜ (z-index: 1000) */
        .search-box { position: sticky; top: 0; background: white; padding: 10px 0; z-index: 1000; display: flex; gap: 10px; border-bottom: 1px solid #fff; }
        
        input { flex: 1; padding: 12px 20px; border: 2px solid #dfe1e5; border-radius: 50px; font-size: 16px; outline: none; -webkit-appearance: none; }
        input:focus { border-color: #1a73e8; box-shadow: 0 0 0 3px rgba(26,115,232,0.2); }
        
        button { padding: 0 20px; background: #1a73e8; color: white; border: none; border-radius: 50px; cursor: pointer; font-size: 15px; white-space: nowrap; font-weight: bold; }
        button:active { background-color: #1557b0; transform: scale(0.98); }
        
        #status { text-align: center; padding: 8px; color: #666; font-size: 13px; margin-bottom: 5px; }
        
        /* --- è¡¨æ ¼å€åŸŸå„ªåŒ– --- */
        .table-wrapper { overflow-x: auto; margin-top: 10px; border-radius: 8px; border: 1px solid #eee; -webkit-overflow-scrolling: touch; /* è®“ iOS æ»‘å‹•æ›´é †æš¢ */ }
        table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 800px; }
        
        /* 1. è¡¨é ­ (Th)ï¼šé»åœ¨æœå°‹æ¡†ä¸‹æ–¹ (top: 70px)ï¼Œå±¤ç´šæ¬¡é«˜ (z-index: 900) */
        th { 
            background-color: #1a73e8 !important; 
            color: #ffffff !important; 
            padding: 12px 10px; 
            position: sticky; 
            top: 65px; /* é—œéµä¿®æ­£ï¼šé¿é–‹ä¸Šæ–¹çš„æœå°‹æ¡† */
            z-index: 900; 
            font-weight: 500; 
            text-align: center; 
            white-space: nowrap;
        }
        
        /* 2. å·¦ä¸Šè§’ç¬¬ä¸€æ ¼ (è¡¨é ­çš„æ¨£å“åç¨±)ï¼šè¦åŒæ™‚é»ä¸Šé¢è·Ÿå·¦é‚Šï¼Œå±¤ç´šè¦æ˜¯è¡¨é ­è£¡æœ€é«˜çš„ (z-index: 950) */
        th:first-child {
            position: sticky;
            left: 0;
            z-index: 950;
        }

        /* 3. è³‡æ–™åˆ— (Td) */
        td { padding: 12px 8px; border-bottom: 1px solid #eee; text-align: center; color: #444; font-size: 15px; }
        tr:nth-child(even) { background-color: #f8f9fa; }
        
        /* 4. å·¦å´å›ºå®šæ¬„ (Food Name)ï¼šé»åœ¨å·¦é‚Šï¼Œå±¤ç´šè¦æ¯”æ™®é€šè³‡æ–™é«˜ (z-index: 800) */
        .food-name { 
            text-align: left; 
            font-weight: bold; 
            color: #333; 
            position: sticky; 
            left: 0; 
            background: white; /* å¿…é ˆè¨­å®šèƒŒæ™¯è‰²ï¼Œä¸ç„¶æ»‘å‹•æ™‚æ–‡å­—æœƒé‡ç–Š */
            min-width: 140px; 
            max-width: 200px;
            z-index: 800;
            border-right: 2px solid #eee; /* åŠ å€‹å³é‚Šæ¡†å€éš” */
        }
        
        /* ä¿®æ­£ï¼šå¶æ•¸è¡Œçš„å·¦å´å›ºå®šæ¬„èƒŒæ™¯è‰²è¦è·Ÿè‘—è®Š */
        tr:nth-child(even) .food-name { background-color: #f8f9fa; }

        .kcal { color: #d93025; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ é£Ÿå“ç‡Ÿé¤ŠæŸ¥è©¢</h1>
    <div id="status">æ­£åœ¨æº–å‚™è³‡æ–™åº«...</div>
    
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="è¼¸å…¥é£Ÿç‰©åç¨± (å¦‚: é›ã€è›‹)..." disabled>
        <button onclick="doSearch()">æœå°‹</button>
    </div>

    <div class="table-wrapper">
        <table id="resultTable" style="display:none;">
            <thead>
                <tr>
                    <th style="text-align:left;">æ¨£å“åç¨±</th>
                    <th>ç†±é‡(kcal)</th>
                    <th>è›‹ç™½è³ª(g)</th>
                    <th>è„‚è‚ª(g)</th>
                    <th>ç¢³æ°´(g)</th>
                    <th>éˆ‰(mg)</th>
                    <th>é‰€(mg)</th>
                    <th>ç£·(mg)</th>
                </tr>
            </thead>
            <tbody id="resultBody"></tbody>
        </table>
    </div>
</div>

<script>
    let db = [];
    let colIndices = { name: 2, kcal: 6, pro: 9, fat: 10, cho: 13, na: 22, k: 23, p: 28 };

    Papa.parse("data.csv", {
        download: true,
        header: false,
        skipEmptyLines: true,
        complete: function(results) {
            const rows = results.data;
            
            // æ‰¾æ¨™é¡Œ
            let headerIdx = rows.findIndex(r => r.some(cell => cell && cell.includes("æ¨£å“åç¨±")));
            if (headerIdx === -1) headerIdx = 0;

            const headers = rows[headerIdx];
            headers.forEach((h, i) => {
                if(!h) return;
                const txt = h.trim();
                if (txt === "æ¨£å“åç¨±") colIndices.name = i;
                if (txt.includes("ç†±é‡(kcal)")) colIndices.kcal = i;
                if (txt.includes("ç²—è›‹ç™½(g)")) colIndices.pro = i;
                if (txt.includes("ç²—è„‚è‚ª(g)")) colIndices.fat = i;
                if (txt.includes("ç¸½ç¢³æ°´åŒ–åˆç‰©(g)")) colIndices.cho = i;
                if (txt.includes("éˆ‰(mg)")) colIndices.na = i;
                if (txt.includes("é‰€(mg)")) colIndices.k = i;
                if (txt.includes("ç£·(mg)")) colIndices.p = i;
            });

            db = rows.slice(headerIdx + 1).map(row => ({
                name: row[colIndices.name] ? row[colIndices.name].trim() : "",
                kcal: row[colIndices.kcal] || "0",
                pro:  row[colIndices.pro] || "0",
                fat:  row[colIndices.fat] || "0",
                cho:  row[colIndices.cho] || "0",
                na:   row[colIndices.na] || "0",
                k:    row[colIndices.k] || "0",
                p:    row[colIndices.p] || "0"
            })).filter(item => item.name !== "");

            document.getElementById('status').innerText = `âœ… è³‡æ–™å°±ç·’ï¼Œå…± ${db.length} ç­†ã€‚`;
            document.getElementById('status').style.color = "green";
            document.getElementById('searchInput').disabled = false;
        },
        error: function() {
            document.getElementById('status').innerText = "âŒ è®€å–å¤±æ•—ï¼šdata.csv éºå¤±";
            document.getElementById('status').style.color = "red";
        }
    });

    function doSearch() {
        const query = document.getElementById('searchInput').value.trim().toLowerCase();
        const table = document.getElementById('resultTable');
        const body = document.getElementById('resultBody');

        if (!query) {
            table.style.display = 'none';
            return;
        }

        // æ‰‹æ©Ÿç‰ˆæ•ˆèƒ½å„ªåŒ–ï¼šä¸€æ¬¡åªé¡¯ç¤ºå‰ 30 ç­†ï¼Œé¿å…æ‰‹æ©Ÿå¡é “
        const filtered = db.filter(item => item.name.toLowerCase().includes(query)).slice(0, 30);

        if (filtered.length > 0) {
            table.style.display = 'table';
            body.innerHTML = filtered.map(item => `
                <tr>
                    <td class="food-name">${item.name}</td>
                    <td class="kcal">${item.kcal}</td>
                    <td>${item.pro}</td>
                    <td>${item.fat}</td>
                    <td>${item.cho}</td>
                    <td>${item.na}</td>
                    <td>${item.k}</td>
                    <td>${item.p}</td>
                </tr>
            `).join('');
        } else {
            table.style.display = 'none';
            alert("æ‰¾ä¸åˆ°è©²é£Ÿç‰©ï¼Œè«‹æ›å€‹é—œéµå­—è©¦è©¦ï¼");
        }
    }

    // æ”¯æ´ Enter
    document.getElementById('searchInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') doSearch();
    });
</script>

</body>
</html>
