<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>é£Ÿå“ç‡Ÿé¤ŠæŸ¥è©¢ V4</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #eee; }
        .box { background: white; padding: 20px; border-radius: 10px; max-width: 600px; margin: auto; }
        input { width: 70%; padding: 10px; }
        button { padding: 10px; background: blue; color: white; cursor: pointer; }
        #msg { margin: 10px 0; padding: 10px; background: #fff3cd; font-size: 14px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    </style>
</head>
<body>

<div class="box">
    <h2>ğŸ é£Ÿå“æŸ¥è©¢ç³»çµ±</h2>
    <div id="msg">æ­£åœ¨æª¢æŸ¥æª”æ¡ˆ...</div>
    
    <input type="text" id="keyword" placeholder="è¼¸å…¥åç¨± (å¦‚: é›)">
    <button onclick="find()">æœå°‹</button>

    <div id="out"></div>
</div>

<script>
    let dataList = [];
    // è®€å– data.csv
    Papa.parse("data.csv", {
        download: true,
        header: false,
        complete: function(res) {
            const rows = res.data;
            // æ‰¾å‡ºåŒ…å«ã€Œæ¨£å“åç¨±ã€çš„é‚£ä¸€è¡Œ
            let idx = rows.findIndex(r => r.join('').includes("æ¨£å“åç¨±"));
            
            if (idx !== -1) {
                const head = rows[idx];
                const rowsData = rows.slice(idx + 1);
                
                // è½‰ç‚ºç°¡å–®ç‰©ä»¶
                dataList = rowsData.map(r => {
                    let o = {};
                    head.forEach((h, i) => o[h.trim()] = r[i]);
                    return o;
                });
                document.getElementById('msg').innerText = "âœ… æˆåŠŸè¼‰å…¥ " + dataList.length + " ç­†ã€‚";
            } else {
                document.getElementById('msg').innerText = "âŒ éŒ¯èª¤ï¼šCSV æ ¼å¼ä¸å°ï¼Œæ‰¾ä¸åˆ°ã€Œæ¨£å“åç¨±ã€æ¨™é¡Œã€‚";
            }
        },
        error: function() {
            document.getElementById('msg').innerText = "âŒ éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° data.csv æª”æ¡ˆã€‚";
        }
    });

    function find() {
        const k = document.getElementById('keyword').value.trim();
        if (!k) return;
        
        // æœå°‹
        const res = dataList.filter(item => 
            item['æ¨£å“åç¨±'] && item['æ¨£å“åç¨±'].includes(k)
        ).slice(0, 20);

        if (res.length > 0) {
            let html = '<table><tr><th>åç¨±</th><th>ç†±é‡</th></tr>';
            res.forEach(item => {
                html += `<tr><td>${item['æ¨£å“åç¨±']}</td><td>${item['ç†±é‡(kcal)'] || '0'}</td></tr>`;
            });
            html += '</table>';
            document.getElementById('out').innerHTML = html;
        } else {
            document.getElementById('out').innerHTML = "æŸ¥ç„¡è³‡æ–™";
        }
    }
</script>

</body>
</html>
