<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿå“ç‡Ÿé¤ŠæŸ¥è©¢ç³»çµ± V3</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f4f7f6; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .search-box { display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex: 1; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        button { padding: 12px 20px; background: #1a73e8; color: white; border: none; border-radius: 8px; cursor: pointer; }
        #status { padding: 10px; margin-bottom: 10px; border-radius: 5px; background: #eee; font-size: 14px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #2c3e50; color: white; padding: 10px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #eee; }
        .kcal { color: red; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ é£Ÿå“ç‡Ÿé¤ŠæŸ¥è©¢ç³»çµ±</h1>
    <div id="status">æ­£åœ¨è¼‰å…¥è³‡æ–™...</div>
    
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="è«‹è¼¸å…¥é£Ÿç‰©é—œéµå­— (å¦‚: é›ã€è›‹ã€å¤§éº¥)...">
        <button onclick="doSearch()">æœå°‹</button>
    </div>

    <div style="overflow-x: auto;">
        <table id="resultTable" style="display:none;">
            <thead>
                <tr>
                    <th>é£Ÿç‰©åç¨±</th>
                    <th>ç†±é‡(kcal)</th>
                    <th>è›‹ç™½è³ª(g)</th>
                    <th>è„‚è‚ª(g)</th>
                    <th>ç¢³æ°´(g)</th>
                    <th>éˆ‰(mg)</th>
                </tr>
            </thead>
            <tbody id="resultBody"></tbody>
        </table>
    </div>
</div>

<script>
    let foodDB = [];
    let colMap = {}; // ç”¨ä¾†è¨˜éŒ„æ¬„ä½ç´¢å¼•

    // è®€å– CSV
    Papa.parse("data.csv", {
        download: true,
        header: false,
        complete: function(results) {
            const rows = results.data;
            // 1. æ‰¾åˆ°æ¨™é¡Œåˆ— (å«æœ‰ "æ¨£å“åç¨±" çš„é‚£ä¸€è¡Œ)
            let headerRowIndex = rows.findIndex(r => r.some(c => c && c.includes("æ¨£å“åç¨±")));
            
            if (headerRowIndex === -1) {
                document.getElementById('status').innerText = "âŒ éŒ¯èª¤ï¼šæ‰¾ä¸åˆ°æ¨™é¡Œåˆ—ï¼Œè«‹ç¢ºèª CSV æ ¼å¼ã€‚";
                return;
            }

            const headers = rows[headerRowIndex];
            // 2. è‡ªå‹•å°é½Šé‡è¦æ¬„ä½çš„ index (é˜²æ­¢ç©ºæ ¼æˆ–æ‹¬è™Ÿä¸åŒ)
            headers.forEach((h, i) => {
                if (!h) return;
                const name = h.trim();
                if (name.includes("æ¨£å“åç¨±")) colMap.name = i;
                if (name.includes("ç†±é‡(kcal)")) colMap.kcal = i;
                if (name.includes("ç²—è›‹ç™½(g)")) colMap.pro = i;
                if (name.includes("ç²—è„‚è‚ª(g)")) colMap.fat = i;
                if (name.includes("ç¸½ç¢³æ°´åŒ–åˆç‰©(g)")) colMap.cho = i;
                if (name.includes("éˆ‰(mg)")) colMap.na = i;
            });

            // 3. å„²å­˜è³‡æ–™åˆ—
            foodDB = rows.slice(headerRowIndex + 1).filter(r => r[colMap.name]);
            
            document.getElementById('status').innerText = `âœ… è¼‰å…¥æˆåŠŸï¼å…± ${foodDB.length} ç­†è³‡æ–™ã€‚æŠ“å–åˆ°æ¬„ä½ï¼š${Object.keys(colMap).join(", ")}`;
        }
    });

    function doSearch() {
        const keyword = document.getElementById('searchInput').value.trim().toLowerCase();
        const table = document.getElementById('resultTable');
        const body = document.getElementById('resultBody');

        if (!keyword) return;

        // æœå°‹é‚è¼¯ï¼šæª¢æŸ¥ã€Œæ¨£å“åç¨±ã€æ¬„ä½æ˜¯å¦åŒ…å«é—œéµå­—
        const matches = foodDB.filter(row => 
            row[colMap.name] && row[colMap.name].toLowerCase().includes(keyword)
        ).slice(0, 50);

        if (matches.length > 0) {
            table.style.display = 'table';
            body.innerHTML = matches.map(row => `
                <tr>
                    <td><strong>${row[colMap.name]}</strong></td>
                    <td class="kcal">${row[colMap.kcal] || '0'}</td>
                    <td>${row[colMap.pro] || '0'}</td>
                    <td>${row[colMap.fat] || '0'}</td>
                    <td>${row[colMap.cho] || '0'}</td>
                    <td>${row[colMap.na] || '0'}</td>
                </tr>
            `).join('');
        } else {
            table.style.display = 'none';
            alert("æ‰¾ä¸åˆ°ç›¸é—œé£Ÿç‰©ï¼Œè«‹æ›å€‹é—œéµå­—è©¦è©¦ï¼");
        }
    }

    // æ”¯æ´æŒ‰ Enter æœå°‹
    document.getElementById('searchInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') doSearch();
    });
</script>

</body>
</html>
