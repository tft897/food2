<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é£Ÿå“ç‡Ÿé¤ŠæŸ¥è©¢ç³»çµ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        body { font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", "Segoe UI", Roboto, sans-serif; background-color: #f0f2f5; padding: 15px; margin: 0; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        h1 { color: #1a73e8; text-align: center; margin: 10px 0 20px 0; font-size: 1.5rem; }
        
        /* --- æœå°‹å€åŸŸ --- */
        .search-box { position: sticky; top: 0; background: white; padding: 10px 0; z-index: 1000; display: flex; gap: 10px; border-bottom: 1px solid #fff; }
        input { flex: 1; padding: 12px 20px; border: 2px solid #dfe1e5; border-radius: 50px; font-size: 16px; outline: none; -webkit-appearance: none; }
        input:focus { border-color: #1a73e8; box-shadow: 0 0 0 3px rgba(26,115,232,0.2); }
        button { padding: 0 20px; background: #1a73e8; color: white; border: none; border-radius: 50px; cursor: pointer; font-size: 15px; white-space: nowrap; font-weight: bold; }
        
        #status { text-align: center; padding: 8px; color: #666; font-size: 13px; margin-bottom: 5px; }
        
        /* --- è¡¨æ ¼å€åŸŸ --- */
        .table-wrapper { overflow-x: auto; margin-top: 10px; border-radius: 8px; border: 1px solid #eee; -webkit-overflow-scrolling: touch; }
        table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 800px; }
        
        th { background-color: #1a73e8 !important; color: white !important; padding: 12px 10px; position: sticky; top: 65px; z-index: 900; font-weight: 500; text-align: center; white-space: nowrap; }
        th:first-child { position: sticky; left: 0; z-index: 950; }

        td { padding: 12px 8px; border-bottom: 1px solid #eee; text-align: center; color: #444; font-size: 15px; cursor: pointer; }
        
        /* é»æ“Šè¡Œçš„äº’å‹•æ•ˆæœ */
        tr.data-row:hover { background-color: #e8f0fe !important; }
        tr.data-row:active { background-color: #d2e3fc !important; }

        tr:nth-child(even) { background-color: #f8f9fa; }
        
        .food-name { text-align: left; font-weight: bold; color: #1a73e8; position: sticky; left: 0; background: white; min-width: 140px; max-width: 200px; z-index: 800; border-right: 2px solid #eee; text-decoration: underline; text-underline-offset: 4px; }
        tr:nth-child(even) .food-name { background-color: #f8f9fa; }
        .kcal { color: #d93025; font-weight: bold; }

        /* --- è©³æƒ…å½ˆçª— (Modal) --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; display: none; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.3s; }
        .modal-container { background: white; width: 90%; max-width: 600px; max-height: 85vh; border-radius: 12px; display: flex; flex-direction: column; box-shadow: 0 10px 25px rgba(0,0,0,0.2); transform: translateY(20px); transition: transform 0.3s; }
        .modal-header { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: #1a73e8; border-radius: 12px 12px 0 0; color: white; }
        .modal-title { font-size: 1.2rem; font-weight: bold; }
        .close-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 0; }
        
        .modal-body { padding: 0; overflow-y: auto; flex: 1; }
        .detail-table { width: 100%; border-collapse: collapse; }
        .detail-table tr { border-bottom: 1px solid #f0f0f0; }
        .detail-table th { background: #f8f9fa !important; color: #555 !important; text-align: left; position: static; width: 50%; font-size: 14px; padding: 10px 15px; }
        .detail-table td { text-align: right; padding: 10px 15px; color: #333; font-weight: bold; font-size: 14px; position: static; cursor: text; }

        /* Modal å‹•ç•«å•Ÿç”¨ç‹€æ…‹ */
        .modal-overlay.active { opacity: 1; }
        .modal-overlay.active .modal-container { transform: translateY(0); }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ é£Ÿå“ç‡Ÿé¤ŠæŸ¥è©¢</h1>
    <div id="status">æ­£åœ¨æº–å‚™è³‡æ–™åº«...</div>
    
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="è¼¸å…¥é£Ÿç‰©åç¨± (å¦‚: é›è›‹)..." disabled>
        <button onclick="doSearch()">æœå°‹</button>
    </div>

    <div class="table-wrapper">
        <table id="resultTable" style="display:none;">
            <thead>
                <tr>
                    <th style="text-align:left;">æ¨£å“åç¨± (é»æ“Šçœ‹è©³æƒ…)</th>
                    <th>ç†±é‡(kcal)</th>
                    <th>è›‹ç™½è³ª(g)</th>
                    <th>è„‚è‚ª(g)</th>
                    <th>ç¢³æ°´(g)</th>
                    <th>éˆ‰(mg)</th>
                    <th>é‰€(mg)</th>
                    <th>ç£·(mg)</th>
                </tr>
            </thead>
            <tbody id="resultBody"></tbody>
        </table>
    </div>
</div>

<div id="detailModal" class="modal-overlay" onclick="closeModal(event)">
    <div class="modal-container" onclick="event.stopPropagation()"> <div class="modal-header">
            <span class="modal-title" id="modalTitle">é£Ÿç‰©åç¨±</span>
            <button class="close-btn" onclick="closeModal()">Ã—</button>
        </div>
        <div class="modal-body">
            <table class="detail-table">
                <tbody id="modalContent"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let db = [];
    let currentFiltered = []; // å„²å­˜ç›®å‰çš„æœå°‹çµæœï¼Œæ–¹ä¾¿é»æ“Šæ™‚æŠ“è³‡æ–™
    
    // é—œéµæ¬„ä½çš„åç¨± (ç”¨æ–¼åˆ—è¡¨é¡¯ç¤º)ï¼Œä¹‹å¾Œæœƒè‡ªå‹•æŠ“å–æ­£ç¢ºæ¨™é¡Œ
    let keyMap = { name: "", kcal: "", pro: "", fat: "", cho: "", na: "", k: "", p: "" };

    Papa.parse("data.csv", {
        download: true,
        header: false,
        skipEmptyLines: true,
        complete: function(results) {
            const rows = results.data;
            
            // 1. æ‰¾æ¨™é¡Œåˆ—
            let headerIdx = rows.findIndex(r => r.some(cell => cell && cell.includes("æ¨£å“åç¨±")));
            if (headerIdx === -1) headerIdx = 0;

            const headers = rows[headerIdx];
            
            // 2. å»ºç«‹å®Œæ•´çš„è³‡æ–™ç‰©ä»¶ & æŠ“å‡ºåˆ—è¡¨éœ€è¦çš„é—œéµæ¬„ä½åç¨±
            headers.forEach((h) => {
                if(!h) return;
                const txt = h.trim();
                // å°æ‡‰åˆ—è¡¨éœ€è¦çš„æ¬„ä½
                if (txt === "æ¨£å“åç¨±") keyMap.name = txt;
                if (txt.includes("ç†±é‡(kcal)")) keyMap.kcal = txt;
                if (txt.includes("ç²—è›‹ç™½(g)")) keyMap.pro = txt;
                if (txt.includes("ç²—è„‚è‚ª(g)")) keyMap.fat = txt;
                if (txt.includes("ç¸½ç¢³æ°´åŒ–åˆç‰©(g)")) keyMap.cho = txt;
                if (txt.includes("éˆ‰(mg)")) keyMap.na = txt;
                if (txt.includes("é‰€(mg)")) keyMap.k = txt;
                if (txt.includes("ç£·(mg)")) keyMap.p = txt;
            });

            // 3. è½‰æ›æ¯ä¸€è¡Œç‚ºä¸€å€‹å®Œæ•´çš„ç‰©ä»¶ (åŒ…å«æ‰€æœ‰æ¬„ä½)
            db = rows.slice(headerIdx + 1).map(row => {
                let obj = {};
                headers.forEach((h, i) => {
                    if(h) obj[h.trim()] = row[i] || ""; // æŠŠæ‰€æœ‰æ¬„ä½éƒ½å­˜èµ·ä¾†
                });
                return obj;
            }).filter(item => item[keyMap.name]); // éæ¿¾æ‰æ²’æœ‰åç¨±çš„ç©ºè¡Œ

            document.getElementById('status').innerText = `âœ… è³‡æ–™å°±ç·’ï¼Œå…± ${db.length} ç­†ã€‚é»æ“Šé£Ÿç‰©åç¨±å¯çœ‹å®Œæ•´æˆåˆ†ã€‚`;
            document.getElementById('status').style.color = "green";
            document.getElementById('searchInput').disabled = false;
        },
        error: function() {
            document.getElementById('status').innerText = "âŒ è®€å–å¤±æ•—ï¼šdata.csv éºå¤±";
            document.getElementById('status').style.color = "red";
        }
    });

    function doSearch() {
        const query = document.getElementById('searchInput').value.trim().toLowerCase();
        const table = document.getElementById('resultTable');
        const body = document.getElementById('resultBody');

        if (!query) {
            table.style.display = 'none';
            return;
        }

        // æœå°‹ä¸¦å­˜å…¥ currentFiltered
        currentFiltered = db.filter(item => item[keyMap.name].toLowerCase().includes(query)).slice(0, 50);

        if (currentFiltered.length > 0) {
            table.style.display = 'table';
            // ç”¢ç”Ÿåˆ—è¡¨ï¼Œæ³¨æ„é€™è£¡åŠ äº† onclick="showDetail(index)"
            body.innerHTML = currentFiltered.map((item, index) => `
                <tr class="data-row" onclick="showDetail(${index})">
                    <td class="food-name">${item[keyMap.name]}</td>
                    <td class="kcal">${item[keyMap.kcal]}</td>
                    <td>${item[keyMap.pro]}</td>
                    <td>${item[keyMap.fat]}</td>
                    <td>${item[keyMap.cho]}</td>
                    <td>${item[keyMap.na]}</td>
                    <td>${item[keyMap.k]}</td>
                    <td>${item[keyMap.p]}</td>
                </tr>
            `).join('');
        } else {
            table.style.display = 'none';
            alert("æ‰¾ä¸åˆ°è©²é£Ÿç‰©ï¼Œè«‹æ›å€‹é—œéµå­—è©¦è©¦ï¼");
        }
    }

    // é¡¯ç¤ºè©³æƒ…å½ˆçª—
    function showDetail(index) {
        const item = currentFiltered[index];
        const modal = document.getElementById('detailModal');
        const title = document.getElementById('modalTitle');
        const content = document.getElementById('modalContent');
        
        // è¨­å®šæ¨™é¡Œ
        title.innerText = item[keyMap.name];

        // ç”¢ç”Ÿæ‰€æœ‰ç‡Ÿé¤Šæˆåˆ†çš„åˆ—è¡¨
        let html = '';
        for (const [key, value] of Object.entries(item)) {
            // éæ¿¾æ‰ç©ºå€¼æˆ–ä¸éœ€è¦é¡¯ç¤ºçš„æ¬„ä½ (å¯é¸)
            if (key !== "æ¨£å“åç¨±" && value !== "" && value !== "0" && value !== "0.0") {
                html += `
                    <tr>
                        <th>${key}</th>
                        <td>${value}</td>
                    </tr>
                `;
            }
        }
        content.innerHTML = html;

        // é¡¯ç¤ºå½ˆçª— (åŠ å‹•ç•« class)
        modal.style.display = 'flex';
        setTimeout(() => modal.classList.add('active'), 10);
    }

    // é—œé–‰å½ˆçª—
    function closeModal(event) {
        const modal = document.getElementById('detailModal');
        modal.classList.remove('active');
        setTimeout(() => modal.style.display = 'none', 300); // ç­‰å‹•ç•«çµæŸå†éš±è—
    }

    // æ”¯æ´ Enter
    document.getElementById('searchInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') doSearch();
    });
</script>

</body>
</html>
